a["2"][0][3]
a["2"][0][4]


Давай вернёмся к коду Trader. Нужно реализовать логику позиций, ордеров и take_profit.
Под позицией я имею в виду запоминание цены покупки каждого лота и её удаление после реализации ордера на продажу.
Ордер на продажу выставляется сразу после покупки с ценой равной цене покупки плюс гиперпараметр take_profit.
В рамках бэктеста реализацией ордера на продажу считать достижение курса ask цены ордера.
Для выставления ордеров на покупку и продажу создай отдельные методы.

в методе run_backtest, начиная с "if self.trader.tick_count > self.trader.window_size + self.trader.ignore_last:", ты копируешь код класса Trader. Так делать нельзя. Давай информацию о сделках возвращать в методе process_tick.
Во-вторых, отрисовку графиков надо вести одновременно с торговлей, то есть внутри run_backtest в главном его цикле, чтобы наблюдать за этим процессом в реальном времени. 